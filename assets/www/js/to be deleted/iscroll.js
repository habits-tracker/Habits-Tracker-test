/**
 * 
 * Find more about the scrolling function at
 * http://cubiq.org/iscroll
 *
 * Copyright (c) 2010 Matteo Spinelli, http://cubiq.org/
 * Released under MIT license
 * http://cubiq.org/dropbox/mit-license.txt
 * 
 * Version 3.7.1 - Last updated: 2010.10.08
 * 
 */(function(){function a(a,b){var k=this,l;k.element=typeof a=="object"?a:document.getElementById(a),k.wrapper=k.element.parentNode,k.element.style.webkitTransitionProperty="-webkit-transform",k.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)",k.element.style.webkitTransitionDuration="0",k.element.style.webkitTransform=i+"0,0"+j,k.options={bounce:c,momentum:c,checkDOMChanges:!0,topOnDOMChanges:!1,hScrollbar:c,vScrollbar:c,fadeScrollbar:d||!e,shrinkScrollbar:d||!e,desktopCompatibility:!1,overflow:"auto",snap:!1,bounceLock:!1,marginHeight:30,scrollbarColor:"rgba(0,0,0,0.5)",onScrollEnd:function(){}};if(typeof b=="object")for(l in b)k.options[l]=b[l];k.options.desktopCompatibility&&(k.options.overflow="hidden"),k.onScrollEnd=k.options.onScrollEnd,delete k.options.onScrollEnd,k.wrapper.style.overflow=k.options.overflow,k.refresh(),window.addEventListener("onorientationchange"in window?"orientationchange":"resize",k,!1);if(e||k.options.desktopCompatibility)k.element.addEventListener(f,k,!1),k.element.addEventListener(g,k,!1),k.element.addEventListener(h,k,!1);k.options.checkDOMChanges&&k.element.addEventListener("DOMSubtreeModified",k,!1)}function b(a,b,c,d,e){var f=this,g=document;f.dir=a,f.fade=c,f.shrink=d,f.uid=++k,f.bar=g.createElement("div"),f.bar.style.cssText="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:"+e+";"+"-webkit-transform:"+i+"0,0"+j+";"+(a=="horizontal"?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px"),f.wrapper=g.createElement("div"),f.wrapper.style.cssText="-webkit-mask:-webkit-canvas(scrollbar"+f.uid+f.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(c?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+(f.dir=="horizontal"?"bottom:2px;left:2px;right:7px;height:5px":"top:2px;right:2px;bottom:7px;width:5px;"),f.wrapper.appendChild(f.bar),b.appendChild(f.wrapper)}a.prototype={x:0,y:0,enabled:!0,handleEvent:function(a){var b=this;switch(a.type){case f:b.touchStart(a);break;case g:b.touchMove(a);break;case h:b.touchEnd(a);break;case"webkitTransitionEnd":b.transitionEnd();break;case"orientationchange":case"resize":b.refresh();break;case"DOMSubtreeModified":b.onDOMModified(a)}},onDOMModified:function(a){var b=this;if(a.target.parentNode!=b.element)return;setTimeout(function(){b.refresh()},0),b.options.topOnDOMChanges&&(b.x!=0||b.y!=0)&&b.scrollTo(0,0,"0")},refresh:function(){var a=this,c=a.x,d=a.y,e;a.scrollWidth=a.wrapper.clientWidth,a.scrollHeight=a.wrapper.clientHeight,a.scrollerWidth=a.element.offsetWidth,a.scrollerHeight=a.element.offsetHeight+a.options.marginHeight,a.maxScrollX=a.scrollWidth-a.scrollerWidth,a.maxScrollY=a.scrollHeight-a.scrollerHeight,a.directionX=0,a.directionY=0,a.scrollX&&(a.maxScrollX>=0?c=0:a.x<a.maxScrollX&&(c=a.maxScrollX)),a.scrollY&&(a.maxScrollY>=0?d=0:a.y<a.maxScrollY&&(d=a.maxScrollY)),a.options.snap&&(a.maxPageX=-Math.floor(a.maxScrollX/a.scrollWidth),a.maxPageY=-Math.floor(a.maxScrollY/a.scrollHeight),e=a.snap(c,d),c=e.x,d=e.y);if(c!=a.x||d!=a.y)a.setTransitionTime("0"),a.setPosition(c,d,!0);a.scrollX=a.scrollerWidth>a.scrollWidth,a.scrollY=!a.options.bounceLock&&!a.scrollX||a.scrollerHeight>a.scrollHeight,a.options.hScrollbar&&a.scrollX?(a.scrollBarX=a.scrollBarX||new b("horizontal",a.wrapper,a.options.fadeScrollbar,a.options.shrinkScrollbar,a.options.scrollbarColor),a.scrollBarX.init(a.scrollWidth,a.scrollerWidth)):a.scrollBarX&&(a.scrollBarX=a.scrollBarX.remove()),a.options.vScrollbar&&a.scrollY&&a.scrollerHeight>a.scrollHeight?(a.scrollBarY=a.scrollBarY||new b("vertical",a.wrapper,a.options.fadeScrollbar,a.options.shrinkScrollbar,a.options.scrollbarColor),a.scrollBarY.init(a.scrollHeight,a.scrollerHeight)):a.scrollBarY&&(a.scrollBarY=a.scrollBarY.remove())},setPosition:function(a,b,c){var d=this;d.x=a,d.y=b,d.element.style.webkitTransform=i+d.x+"px,"+d.y+"px"+j,c||(d.scrollBarX&&d.scrollBarX.setPosition(d.x),d.scrollBarY&&d.scrollBarY.setPosition(d.y))},setTransitionTime:function(a){var b=this;a=a||"0",b.element.style.webkitTransitionDuration=a,b.scrollBarX&&(b.scrollBarX.bar.style.webkitTransitionDuration=a,b.scrollBarX.wrapper.style.webkitTransitionDuration=c&&b.options.fadeScrollbar?"300ms":"0"),b.scrollBarY&&(b.scrollBarY.bar.style.webkitTransitionDuration=a,b.scrollBarY.wrapper.style.webkitTransitionDuration=c&&b.options.fadeScrollbar?"300ms":"0")},touchStart:function(a){var b=this,c;if(!b.enabled)return;a.preventDefault(),a.stopPropagation(),b.scrolling=!0,b.moved=!1,b.distX=0,b.distY=0,b.setTransitionTime("0");if(b.options.momentum||b.options.snap){c=new WebKitCSSMatrix(window.getComputedStyle(b.element).webkitTransform);if(c.e!=b.x||c.f!=b.y)document.removeEventListener("webkitTransitionEnd",b,!1),b.setPosition(c.e,c.f),b.moved=!0}b.touchStartX=e?a.changedTouches[0].pageX:a.pageX,b.scrollStartX=b.x,b.touchStartY=e?a.changedTouches[0].pageY:a.pageY,b.scrollStartY=b.y,b.scrollStartTime=a.timeStamp,b.directionX=0,b.directionY=0},touchMove:function(a){if(!this.scrolling)return;var b=this,c=e?a.changedTouches[0].pageX:a.pageX,d=e?a.changedTouches[0].pageY:a.pageY,f=b.scrollX?c-b.touchStartX:0,g=b.scrollY?d-b.touchStartY:0,h=b.x+f,i=b.y+g;a.stopPropagation(),b.touchStartX=c,b.touchStartY=d;if(h>=0||h<b.maxScrollX)h=b.options.bounce?Math.round(b.x+f/3):h>=0||b.maxScrollX>=0?0:b.maxScrollX;if(i>=0||i<b.maxScrollY)i=b.options.bounce?Math.round(b.y+g/3):i>=0||b.maxScrollY>=0?0:b.maxScrollY;b.distX+b.distY>5?(b.distX-3>b.distY?(i=b.y,g=0):b.distY-3>b.distX&&(h=b.x,f=0),b.setPosition(h,i),b.moved=!0,b.directionX=f>0?-1:1,b.directionY=g>0?-1:1):(b.distX+=Math.abs(f),b.distY+=Math.abs(g))},touchEnd:function(a){if(!this.scrolling)return;var b=this,c=a.timeStamp-b.scrollStartTime,d=e?a.changedTouches[0]:a,f,g,h,i,j=0,k=b.x,l=b.y,m;b.scrolling=!1;if(!b.moved){b.resetPosition();if(e){f=d.target;while(f.nodeType!=1)f=f.parentNode;g=document.createEvent("MouseEvents"),g.initMouseEvent("click",!0,!0,a.view,1,d.screenX,d.screenY,d.clientX,d.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),g._fake=!0,f.dispatchEvent(g)}return}if(!b.options.snap&&c>250){b.resetPosition();return}b.options.momentum&&(h=b.scrollX===!0?b.momentum(b.x-b.scrollStartX,c,b.options.bounce?-b.x+b.scrollWidth/5:-b.x,b.options.bounce?b.x+b.scrollerWidth-b.scrollWidth+b.scrollWidth/5:b.x+b.scrollerWidth-b.scrollWidth):{dist:0,time:0},i=b.scrollY===!0?b.momentum(b.y-b.scrollStartY,c,b.options.bounce?-b.y+b.scrollHeight/5:-b.y,b.options.bounce?(b.maxScrollY<0?b.y+b.scrollerHeight-b.scrollHeight:0)+b.scrollHeight/5:b.y+b.scrollerHeight-b.scrollHeight):{dist:0,time:0},j=Math.max(Math.max(h.time,i.time),1),k=b.x+h.dist,l=b.y+i.dist),b.options.snap&&(m=b.snap(k,l),k=m.x,l=m.y,j=Math.max(m.time,j)),b.scrollTo(k,l,j+"ms")},transitionEnd:function(){var a=this;document.removeEventListener("webkitTransitionEnd",a,!1),a.resetPosition()},resetPosition:function(){var a=this,b=a.x,c=a.y;a.x>=0?b=0:a.x<a.maxScrollX&&(b=a.maxScrollX),a.y>=0||a.maxScrollY>0?c=0:a.y<a.maxScrollY&&(c=a.maxScrollY),b!=a.x||c!=a.y?a.scrollTo(b,c):(a.moved&&(a.onScrollEnd(),a.moved=!1),a.scrollBarX&&a.scrollBarX.hide(),a.scrollBarY&&a.scrollBarY.hide())},snap:function(a,b){var c=this,d;return c.directionX>0?a=Math.floor(a/c.scrollWidth):c.directionX<0?a=Math.ceil(a/c.scrollWidth):a=Math.round(a/c.scrollWidth),c.pageX=-a,a*=c.scrollWidth,a>0?a=c.pageX=0:a<c.maxScrollX&&(c.pageX=c.maxPageX,a=c.maxScrollX),c.directionY>0?b=Math.floor(b/c.scrollHeight):c.directionY<0?b=Math.ceil(b/c.scrollHeight):b=Math.round(b/c.scrollHeight),c.pageY=-b,b*=c.scrollHeight,b>0?b=c.pageY=0:b<c.maxScrollY&&(c.pageY=c.maxPageY,b=c.maxScrollY),d=Math.round(Math.max(Math.abs(c.x-a)/c.scrollWidth*500,Math.abs(c.y-b)/c.scrollHeight*500)),{x:a,y:b,time:d}},scrollTo:function(a,b,c){var d=this;if(d.x==a&&d.y==b){d.resetPosition();return}d.moved=!0,d.setTransitionTime(c||"350ms"),d.setPosition(a,b),c==="0"||c=="0s"||c=="0ms"?d.resetPosition():document.addEventListener("webkitTransitionEnd",d,!1)},scrollToPage:function(a,b,c){var d=this,e;d.options.snap||(d.pageX=-Math.round(d.x/d.scrollWidth),d.pageY=-Math.round(d.y/d.scrollHeight)),a=="next"?a=++d.pageX:a=="prev"&&(a=--d.pageX),b=="next"?b=++d.pageY:b=="prev"&&(b=--d.pageY),a=-a*d.scrollWidth,b=-b*d.scrollHeight,e=d.snap(a,b),a=e.x,b=e.y,d.scrollTo(a,b,c||"500ms")},scrollToElement:function(a,b){a=typeof a=="object"?a:this.element.querySelector(a);if(!a)return;var c=this,d=c.scrollX?-a.offsetLeft:0,e=c.scrollY?-a.offsetTop:0;d>=0?d=0:d<c.maxScrollX&&(d=c.maxScrollX),e>=0?e=0:e<c.maxScrollY&&(e=c.maxScrollY),c.scrollTo(d,e,b)},momentum:function(a,b,c,d){var e=2.5,f=1.2,g=Math.abs(a)/b*1e3,h=g*g/e/1e3,i=0;return a>0&&h>c?(g=g*c/h/e,h=c):a<0&&h>d&&(g=g*d/h/e,h=d),h*=a<0?-1:1,i=g/f,{dist:Math.round(h),time:Math.round(i)}},destroy:function(a){var b=this;return window.removeEventListener("onorientationchange"in window?"orientationchange":"resize",b,!1),b.element.removeEventListener(f,b,!1),b.element.removeEventListener(g,b,!1),b.element.removeEventListener(h,b,!1),document.removeEventListener("webkitTransitionEnd",b,!1),b.options.checkDOMChanges&&b.element.removeEventListener("DOMSubtreeModified",b,!1),b.scrollBarX&&(b.scrollBarX=b.scrollBarX.remove()),b.scrollBarY&&(b.scrollBarY=b.scrollBarY.remove()),a&&b.wrapper.parentNode.removeChild(b.wrapper),null}},b.prototype={init:function(a,b){var c=this,d=document,e=Math.PI,f;c.dir=="horizontal"?c.maxSize!=c.wrapper.offsetWidth&&(c.maxSize=c.wrapper.offsetWidth,f=d.getCSSCanvasContext("2d","scrollbar"+c.uid+c.dir,c.maxSize,5),f.fillStyle="rgb(0,0,0)",f.beginPath(),f.arc(2.5,2.5,2.5,e/2,-e/2,!1),f.lineTo(c.maxSize-2.5,0),f.arc(c.maxSize-2.5,2.5,2.5,-e/2,e/2,!1),f.closePath(),f.fill()):c.maxSize!=c.wrapper.offsetHeight&&(c.maxSize=c.wrapper.offsetHeight,f=d.getCSSCanvasContext("2d","scrollbar"+c.uid+c.dir,5,c.maxSize),f.fillStyle="rgb(0,0,0)",f.beginPath(),f.arc(2.5,2.5,2.5,e,0,!1),f.lineTo(5,c.maxSize-2.5),f.arc(2.5,c.maxSize-2.5,2.5,0,e,!1),f.closePath(),f.fill()),c.size=Math.max(Math.round(c.maxSize*c.maxSize/b),6),c.maxScroll=c.maxSize-c.size,c.toWrapperProp=c.maxScroll/(a-b),c.bar.style[c.dir=="horizontal"?"width":"height"]=c.size+"px"},setPosition:function(a){var b=this;b.wrapper.style.opacity!="1"&&b.show(),a=Math.round(b.toWrapperProp*a),a<0?(a=b.shrink?a+a*3:0,b.size+a<7&&(a=-b.size+6)):a>b.maxScroll&&(a=b.shrink?a+(a-b.maxScroll)*3:b.maxScroll,b.size+b.maxScroll-a<7&&(a=b.size+b.maxScroll-6)),a=b.dir=="horizontal"?i+a+"px,0"+j:i+"0,"+a+"px"+j,b.bar.style.webkitTransform=a},show:function(){c&&(this.wrapper.style.webkitTransitionDelay="0"),this.wrapper.style.opacity="1"},hide:function(){c&&(this.wrapper.style.webkitTransitionDelay="350ms"),this.wrapper.style.opacity="0"},remove:function(){return this.wrapper.parentNode.removeChild(this.wrapper),null}};var c="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,d=/iphone|ipad/gi.test(navigator.appVersion),e="ontouchstart"in window,f=e?"touchstart":"mousedown",g=e?"touchmove":"mousemove",h=e?"touchend":"mouseup",i="translate"+(c?"3d(":"("),j=c?",0)":")",k=0;window.iScroll=a})();